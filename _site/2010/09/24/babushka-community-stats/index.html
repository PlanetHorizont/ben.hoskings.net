<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta content="width = 660" name="viewport" />
    <title>ben hoskings</title>
    <link href="/stylesheets/styles.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/index.atom" rel="alternate" title="Atom feed" type="application/atom+xml" />
    <script type="text/javascript">
      //<![CDATA[
        /**
          head.js    The only script in your <HEAD>
          Copyright  Tero Piirainen (tipiirai)
          License    MIT / http://bit.ly/mit-license
        
          http://headjs.com
        */(function(a){var b=a.documentElement,c={screens:[320,480,640,768,1024,1280,1440,1680,1920],section:"-section",page:"-page",head:"head"},d=[];if(window.head_conf)for(var e in head_conf)head_conf[e]&&(c[e]=head_conf[e]);function f(a){d.push(a)}function g(a){var c=new RegExp("\\b"+a+"\\b");b.className=b.className.replace(c,"")}function h(a,b){for(var c=0;c<a.length;c++)b.call(a,a[c],c)}var i=window[c.head]=function(){i.ready.apply(null,arguments)};i.feature=function(a,c,e){if(!a){b.className+=" "+d.join(" ");return d=[]}Object.prototype.toString.call(c)=="[object Function]"&&(c=c.call()),f((c?"":"no-")+a),i[a]=!!c,e||(g("no-"+a),g(a),i.feature());return i};var j=navigator.userAgent.toLowerCase();j=/(webkit)[ \/]([\w.]+)/.exec(j)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(j)||/(msie) ([\w.]+)/.exec(j)||!/compatible/.test(j)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(j)||[],j[1]=="msie"&&(j[1]="ie"),f(j[1]),i.browser={version:j[2]},i.browser[j[1]]=true;if(i.browser.ie)for(var k=3;k<11;k++)parseFloat(j[2])<k&&f("lt-ie"+k);h("abbr|article|aside|audio|canvas|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video".split("|"),function(b){a.createElement(b)}),h(location.pathname.split("/"),function(a,d){if(this.length>2&&this[d+1])d&&f(this.slice(1,d+1).join("-")+c.section);else{var e=a||"index",g=e.indexOf(".");g>0&&(e=e.substring(0,g)),b.id=e+c.page,d||f("root"+c.section)}});function l(){var a=window.outerWidth||b.clientWidth;b.className=b.className.replace(/ (w|lt)-\d+/g,""),f("w-"+Math.round(a/100)*100),h(c.screens,function(b){a<=b&&f("lt-"+b)}),i.feature()}l(),window.onresize=l,i.feature("script",true).feature()})(document),function(){var a=document.createElement("i"),b=a.style,c=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),d=window.head_conf&&head_conf.head||"head",e=window[d];function f(a){b.cssText=c.join(a+";");var d=b.cssText;if(d.indexOf("-o")!=-1&&d.indexOf("-ms")!=-1)return false;return!!d}var g={gradient:function(){var a="background-image:",d="gradient(linear,left top,right bottom,from(#9f9),to(#fff));",e="linear-gradient(left top,#eee,#fff);";b.cssText=(a+c.join(d+a)+c.join(e+a)).slice(0,-a.length);return!!b.backgroundImage},rgba:function(){b.cssText="background-color:rgba(0,0,0,0.5)";return!!b.backgroundColor},boxshadow:function(){return f("box-shadow: 0 0 0 red")},textshadow:function(){return b.textShadow===""},multiplebgs:function(){b.cssText="background:url(//:),url(//:),red url(//:)";return(new RegExp("(url\\s*\\(.*?){3}")).test(b.background)},borderimage:function(){return f("border-image: url(m.png) 1 1 stretch")},borderradius:function(){return f("border-radius:0")},opacity:function(){return a.style.opacity===""},reflections:function(){return f("box-reflect:right 0")},transforms:function(){return f("transform:rotate(1deg)")},transitions:function(){return f("transition:all .1s linear")}};for(var h in g)g[h]&&e.feature(h,g[h].call(),true);e.feature()}(),function(a){var b=a.documentElement,c=navigator.userAgent.toLowerCase().indexOf("msie")!=-1,d=false,e=[],f={},g={};var h=window.head_conf&&head_conf.head||"head",i=window[h]=window[h]||function(){i.ready.apply(null,arguments)};i.js=function(){var a=arguments,b=[].slice.call(a,1),c=b[0];if(!d){e.push(function(){i.js.apply(null,a)});return i}c?(l(c)||k(b,function(a){l(a)||n(j(a))}),o(j(a[0]),l(c)?c:function(){i.js.apply(null,b)})):o(j(a[0]));return i},i.ready=function(a,b){var c=g[a];if(c&&c.state=="loaded"){b.call();return i}l(a)&&(b=a,a="ALL");var d=f[a];d?d.push(b):d=f[a]=[b];return i};function j(a){var b=g[a.name||a];if(b)return b;if(typeof a=="object")for(var c in a)a[c]&&(b={name:c,url:a[c]});else{var d=a.split("/"),e=d[d.length-1],f=e.indexOf("?");b={name:f!=-1?e.substring(0,f):e,url:a}}g[b.name]=b;return b}function k(a,b){if(a){typeof a=="object"&&(a=[].slice.call(a));for(var c=0;c<a.length;c++)b.call(a,a[c],c)}}function l(a){return Object.prototype.toString.call(a)=="[object Function]"}function m(a){a.state="preloaded",k(a.onpreload,function(a){a.call()})}function n(c,d){if(!c.state){c.state="preloading",c.onpreload=[];if(/Firefox/.test(navigator.userAgent)){var e=a.createElement("object");e.data=c.url,e.width=0,e.height=0,e.onload=function(){m(c),setTimeout(function(){b.removeChild(e)},1)},b.appendChild(e)}else p({src:c.url,type:"cache"},function(){m(c)})}}function o(a,b){if(a.state=="loaded")return b();if(a.state=="preloading")return a.onpreload.push(function(){o(a,b)});a.state="loading",p(a.url,function(){a.state="loaded",b&&b.call(),k(f[a.name],function(a){a.call()});var c=true;for(var d in g)g[d].state!="loaded"&&(c=false);c&&k(f.ALL,function(a){a.done||a.call(),a.done=true})})}function p(d,e){var f=a.createElement("script");f.type="text/"+(d.type||"javascript"),f.src=d.src||d,f.onreadystatechange=f.onload=function(){var a=f.readyState;!e.done&&(!a||/loaded|complete/.test(a))&&(e.call(),e.done=true),c||b.removeChild(f)},b.appendChild(f)}setTimeout(function(){d=true,k(e,function(a){a.call()})},200)}(document)
      //]]>
    </script>
    <!--[if IE]>
      <script type="text/javascript">
        //<![CDATA[
          // For discussion and comments, see: http://remysharp.com/2009/01/07/html5-enabling-script/
          (function(){if(!/*@cc_on!@*/0)return;var e = "abbr,article,aside,audio,bb,canvas,datagrid,datalist,details,dialog,eventsource,figure,footer,header,hgroup,mark,menu,meter,nav,output,progress,section,time,video".split(',');for(var i=0;i<e.length;i++){document.createElement(e[i])}})();
        //]]>
      </script>
    <![endif]-->
  </head>
  <body>
    <header>
      <h1>
        <a href="/">ben hoskings</a>
      </h1>
    </header>
    <nav>
      <a href="http://twitter.com/ben_h" rel="me">twitter</a>
      <a href="http://github.com/benhoskings" rel="me">github</a>
    </nav>
    <article>
      <header>
        <time pubdate="pubdate">2010 September 24</time>
        <h1>
          <a href="/">babushka community stats</a>
        </h1>
      </header>
      <p>I&#8217;ve merged a new feature into babushka&#8217;s <code>next</code> branch that adds functionality in a new direction. The changes teach babushka to collectively build a database of the deps that are being run, their success rates, and where to find them. Babushka can query this database over HTTP, so everyone can discover new deps from babushka itself.</p>
      
      <p>Firstly, while I&#8217;m pretty excited about this, it&#8217;s definitely not a finalised design. Your feedback will shape its future.</p>
      
      <p>Secondly, any tool that sends data to a server immediately raises privacy questions, so I&#8217;d like to describe the design, and show that it&#8217;s truly a community database: open, transparent and anonymous.</p>
      <hr />
      <p><em>So, what is it?</em> Well, there&#8217;s a new command, <code>babushka search</code>, which queries this database, like so. You can try it out yourself if you switch to the <code>next</code> branch:</p>
      
      <pre><code>babushka &#39;babushka next&#39;&#x000A;babushka search tmbundle</code></pre>
      
      <p><img alt='babushka search example' src='/images/babushka-search-example.png' /></p>
      
      <p>The results show matching deps that others have used, and for each, the number of runs this week, and the proportion of those runs that succeeded. This should give you a feel for what&#8217;s popular and what&#8217;s reliable at the moment. For the deps that are in a source on GitHub following the <code>username/babushka-deps</code> convention, the command to instantly run that dep is shown too.</p>
      
      <p><em>This data is collected by babushka itself.</em> Whenever babushka finishes running a dep from a public source, it writes some info about the run to a file. Then, whenever babushka is invoked, it asynchronously submits that info to the babushka web service. It&#8217;s done in the background like this for three reasons:</p>
      
      <ul>
      <li>If it were synchronous, every babushka run would pause for a second or two while babushka contacted the web service, which would suck.</li>
      
      <li>It means the files can accumulate when your machine is offline, and be flushed to the web service whenever babushka is next run online.</li>
      
      <li>You can inspect the files, and see exactly what babushka is sending over the wire.</li>
      </ul>
      <hr />
      <p><em>If this system weren&#8217;t carefully implemented, it would be a privacy problem.</em> I&#8217;ve designed the system in a way that I believe is completely transparent. You don&#8217;t have to trust me in order to use babushka.</p>
      
      <ul>
      <li>Firstly (and obviously), <strong>babushka is open source</strong>. The calls it makes to the web service are cleanly defined in the code&#8212;just grep for <code>Net::HTTP</code>.</li>
      
      <li>Secondly, <strong>the web service is also open source</strong>&#8212;the code that runs <code>babushka.me</code> (a rails 3 app) is <a href='http://github.com/benhoskings/babushka.me'>on github</a> for all to see.</li>
      
      <li><strong>The unsent run info is stored on your machine as an HTTP param string</strong>, so you can see the exact data that will be sent before the fact. They&#8217;re in <code>~/.babushka/runs/</code>. (The info for a given run is sent the next time babushka is run.)</li>
      
      <li><strong>Only deps from public sources are reported</strong>&#8212;that is, sources whose URIs start with <code>git://</code>, like read-only GitHub URIs. So if you have private deps that are stored locally on your machine, or in a private source with a <code>user@host</code>-style URI, or anything else, babushka will never submit those to the web service. Only sources pointing to <code>git://</code> remotes are considered.</li>
      
      <li><strong>The web service API is public</strong>&#8212;babushka uses it when it submits runs and queries the database. The web service happily serves up JSON or YAML to anybody.</li>
      
      <li><strong>The database itself is public</strong>, for anyone to download <a href='http://babushka.me/db/babushka.me.psql'>as a postgres dump</a>. It&#8217;s freshly exported by the web service whenever required via <code>babushka &#39;benhoskings:babushka.me db dump&#39;</code>. (It&#8217;s going to get pretty big pretty quickly, but that&#8217;s a problem for later.)</li>
      
      <li>Finally, <strong>the data is totally anonymous anyway</strong>, so avenues via which I can appropriate the data for evil purposes are quite limited.</li>
      </ul>
      
      <p>Here&#8217;s an example. After running <code>babushka benhoskings:Cucumber.tmbundle</code>, here is the info written to <code>~/.babushka/runs</code>, which is the exact data that will be submitted as HTTP params to <code>http://babushka.me/runs.json</code>:</p>
      
      <pre><code>⚡ cat ~/.babushka/runs/1285303540.794963&#x000A;version=0.6.2&amp;run_at=2010-09-24%2014:45:40%20+1000&amp;system_info=Mac%20OS%20X&#x000A;%2010.6.4%20(Snow%20Leopard)&amp;dep_name=Cucumber.tmbundle&amp;source_uri=git://gi&#x000A;thub.com/benhoskings/babushka-deps.git&amp;result=ok</code></pre>
      
      <p>Cleaning that up a bit, we can see that all it knows about me is that I&#8217;m a Mac user and I&#8217;m in GMT+10.</p>
      
      <pre><code>version=0.6.2&#x000A;run_at=2010-09-24 14:45:40 +1000&#x000A;system_info=Mac OS X 10.6.4 (Snow Leopard)&#x000A;dep_name=Cucumber.tmbundle&#x000A;source_uri=git://github.com/benhoskings/babushka-deps.git&#x000A;result=ok</code></pre>
      
      <p>Since that endpoint is public, the database is obviously gameable. But, you know, don&#8217;t do that please.</p>
      <hr />
      <p><em>So, that&#8217;s my idea</em>. It&#8217;s in <code>next</code>, it&#8217;s working, and the database is growing as of now.</p>
      
      <p>I&#8217;d love to hear your thoughts on this new feature, and your experience using it. The best ways to get in touch are to tweet at <a href='http://twitter.com/babushka_app'>@babushka_app</a>, or send a message to the <a href='http://groups.google.com/group/babushka_app/'>mailing list</a>. I&#8217;m keen for your feedback to influence how babushka develops. Sharing is awesome.</p>
    </article>
    <footer>
      <span>
        Powered by
        <a href="http://github.com/mojombo/jekyll">Jekyll</a>
        Content &amp; layout &copy; Ben Hoskings.
      </span>
    </footer>
    <script type="text/javascript">
      //<![CDATA[
        head.js("/scripts/jquery.js");
        head.js("/scripts/images.js");
      //]]>
    </script>
    <script type="text/javascript">
      //<![CDATA[
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
        try {
          var pageTracker = _gat._getTracker("UA-9740324-2");
          pageTracker._trackPageview();
        } catch(err) {}
      //]]>
    </script>
  </body>
</html>
